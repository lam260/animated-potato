-- Vietnam Hub Script - Update: Fix lag + Th√™m Anti ƒêu·ªïi (Anti Kick)
-- Fix lag: Kh√¥ng set hitbox/ESP m·ªói frame n·ªØa, ch·ªâ set khi toggle/on join/respawn
-- Anti Kick: Hook Kick method ƒë·ªÉ prevent kick khi b·∫≠t
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local LocalPlayer = Players.LocalPlayer
local backpack = LocalPlayer.Backpack
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")
local RootPart = Character:WaitForChild("HumanoidRootPart")

-- Toggles
local toggles = {
    autoAttack = false,
    spin = false,
    speed = false,
    hitbox = false,
    esp = false,
    autoBandage = false,
    antiKick = false
}

-- Hitbox settings
local hitboxSize = 20

-- ESP
local espGuis = {}

-- Spin
local spinVel = nil

-- Auto Bandage
local isHealing = false

-- Anti Kick
local oldKick = nil

-- speed
local oldkick = 32

-- ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "VietnamHub"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = CoreGui

-- Main Button (nh·ªè g·ªçn)
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainButton"
MainFrame.Size = UDim2.new(0, 90, 0, 50)
MainFrame.Position = UDim2.new(0.02, 0, 0.02, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 10)
MainCorner.Parent = MainFrame

local FlagImage = Instance.new("ImageLabel")
FlagImage.Size = UDim2.new(1, 0, 1, 0)
FlagImage.BackgroundTransparency = 1
FlagImage.Image = "rbxassetid://11548089657"  -- C·ªù VN
FlagImage.Parent = MainFrame

-- Sub Menu (k√©o ƒë∆∞·ª£c, tƒÉng height)
local SubFrame = Instance.new("Frame")
SubFrame.Name = "SubMenu"
SubFrame.Size = UDim2.new(0, 320, 0, 570)
SubFrame.Position = UDim2.new(0.15, 0, 0.15, 0)
SubFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
SubFrame.BackgroundTransparency = 0.15
SubFrame.Visible = false
SubFrame.Parent = ScreenGui

local SubCorner = Instance.new("UICorner")
SubCorner.CornerRadius = UDim.new(0, 14)
SubCorner.Parent = SubFrame

-- Rainbow vi·ªÅn
local RainbowStroke = Instance.new("UIStroke")
RainbowStroke.Thickness = 3.5
RainbowStroke.Transparency = 0.25
RainbowStroke.Parent = SubFrame

local RainbowGradient = Instance.new("UIGradient")
RainbowGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(255,0,0)),
    ColorSequenceKeypoint.new(0.2, Color3.fromRGB(255,165,0)),
    ColorSequenceKeypoint.new(0.4, Color3.fromRGB(0,255,0)),
    ColorSequenceKeypoint.new(0.6, Color3.fromRGB(0,0,255)),
    ColorSequenceKeypoint.new(0.8, Color3.fromRGB(75,0,130)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(238,130,238))
}
RainbowGradient.Parent = RainbowStroke

RunService.Heartbeat:Connect(function(dt)
    RainbowGradient.Rotation = (RainbowGradient.Rotation or 0) + 120 * dt
end)

-- Title v·ªõi n√∫t ƒë√≥ng
local TitleFrame = Instance.new("Frame")
TitleFrame.Size = UDim2.new(1, 0, 0, 45)
TitleFrame.BackgroundTransparency = 1
TitleFrame.Parent = SubFrame

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Size = UDim2.new(0.8, 0, 1, 0)
TitleLabel.Position = UDim2.new(0.1, 0, 0, 0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "Vietnam Hub"
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.TextSize = 26
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.Parent = TitleFrame

-- N√∫t ƒë√≥ng menu (X m√†u ƒë·ªè)
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(0.9, -15, 0.5, -15)
CloseButton.BackgroundColor3 = Color3.fromRGB(32, 32, 32)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(32, 32, 32)
CloseButton.TextSize = 20
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Parent = TitleFrame

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 6)
CloseCorner.Parent = CloseButton

-- Frame n·ªôi dung ƒë·ªÉ k√©o (tr·ª´ ph·∫ßn title)
local ContentFrame = Instance.new("Frame")
ContentFrame.Size = UDim2.new(1, 0, 1, -45)
ContentFrame.Position = UDim2.new(0, 0, 0, 45)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = SubFrame

-- Tab buttons v·ªõi t√™n g·ªëc c·ªë ƒë·ªãnh (th√™m Anti ƒêu·ªïi)
local tabData = {
    {displayName = "Auto ƒê√°nh", toggleKey = "autoAttack"},
    {displayName = "Xoay", toggleKey = "spin"},
    {displayName = "Speed", toggleKey = "speed"},
    {displayName = "Hitbox", toggleKey = "hitbox"},
    {displayName = "ESP", toggleKey = "esp"},
    {displayName = "Auto BƒÉng G·∫°c", toggleKey = "autoBandage"},
    {displayName = "Anti ƒêu·ªïi", toggleKey = "antiKick"}
}

local tabButtons = {}
for i, data in ipairs(tabData) do
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0.88, 0, 0, 48)
    btn.Position = UDim2.new(0.06, 0, 0, 10 + (i-1)*58)
    btn.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
    btn.Text = data.displayName .. " (T·∫Øt)"
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.TextSize = 18
    btn.Font = Enum.Font.GothamSemibold
    btn.Parent = ContentFrame
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = btn
    
    btn:SetAttribute("OriginalName", data.displayName)
    tabButtons[data.toggleKey] = btn
end

-- Frame cho ƒëi·ªÅu ch·ªânh Hitbox Size (di chuy·ªÉn xu·ªëng d∆∞·ªõi)
local HitboxSizeFrame = Instance.new("Frame")
HitboxSizeFrame.Size = UDim2.new(0.90, 0, 0, 70)
HitboxSizeFrame.Position = UDim2.new(0.08, 0, 0, 500)
HitboxSizeFrame.BackgroundColor3 = Color3.fromRGB(42, 46, 50)
HitboxSizeFrame.Parent = ContentFrame

local HitboxSizeCorner = Instance.new("UICorner")
HitboxSizeCorner.CornerRadius = UDim.new(0, 8)
HitboxSizeCorner.Parent = HitboxSizeFrame

local HitboxTitle = Instance.new("TextLabel")
HitboxTitle.Size = UDim2.new(1, 0, 0.4, 0)
HitboxTitle.Position = UDim2.new(0, 0, 0, 0)
HitboxTitle.BackgroundTransparency = 1
HitboxTitle.Text = "K√≠ch th∆∞·ªõc Hitbox:"
HitboxTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
HitboxTitle.TextSize = 14
HitboxTitle.Font = Enum.Font.GothamSemibold
HitboxTitle.Parent = HitboxSizeFrame

local HitboxInput = Instance.new("TextBox")
HitboxInput.Size = UDim2.new(0.6, 0, 0.5, 0)
HitboxInput.Position = UDim2.new(0.05, 0, 0.45, 0)
HitboxInput.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
HitboxInput.TextColor3 = Color3.fromRGB(255, 255, 255)
HitboxInput.Text = tostring(hitboxSize)
HitboxInput.TextSize = 20
HitboxInput.PlaceholderText = "Nh·∫≠p k√≠ch th∆∞·ªõc"
HitboxInput.ClearTextOnFocus = false
HitboxInput.Parent = HitboxSizeFrame

local HitboxInputCorner = Instance.new("UICorner")
HitboxInputCorner.CornerRadius = UDim.new(0, 4)
HitboxInputCorner.Parent = HitboxInput

local HitboxApplyButton = Instance.new("TextButton")
HitboxApplyButton.Size = UDim2.new(0.25, 0, 0.5, 0)
HitboxApplyButton.Position = UDim2.new(0.7, 0, 0.45, 0)
HitboxApplyButton.BackgroundColor3 = Color3.fromRGB(60, 180, 60)
HitboxApplyButton.Text = "√Åp d·ª•ng"
HitboxApplyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
HitboxApplyButton.TextSize = 20
HitboxApplyButton.Font = Enum.Font.GothamSemibold
HitboxApplyButton.Parent = HitboxSizeFrame

local HitboxApplyCorner = Instance.new("UICorner")
HitboxApplyCorner.CornerRadius = UDim.new(0, 4)
HitboxApplyCorner.Parent = HitboxApplyButton

-- X·ª≠ l√Ω nh·∫≠p k√≠ch th∆∞·ªõc hitbox
HitboxApplyButton.MouseButton1Click:Connect(function()
    local text = HitboxInput.Text
    local num = tonumber(text)
    
    if num and num > 0 then
        hitboxSize = num
        HitboxInput.Text = tostring(hitboxSize)
        
        if toggles.hitbox then
            for _, plr in ipairs(Players:GetPlayers()) do
                if plr ~= LocalPlayer and plr.Character then
                    local root = plr.Character:FindFirstChild("HumanoidRootPart")
                    local torso = plr.Character:FindFirstChild("Torso") or plr.Character:FindFirstChild("UpperTorso")
                    if root then 
                        root.Size = Vector3.new(hitboxSize, hitboxSize, hitboxSize) 
                        root.Transparency = 0.75 
                    end
                    if torso then 
                        torso.Size = Vector3.new(hitboxSize, hitboxSize, hitboxSize) 
                        torso.Transparency = 0.75 
                    end
                end
            end
        end
    else
        HitboxInput.Text = tostring(hitboxSize)
    end
end)

HitboxInput.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        HitboxApplyButton:MouseButton1Click()
    end
end)

-- Draggable MainFrame
local mainDragging, mainDragInput, mainDragStart, mainStartPos
MainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        mainDragging = true
        mainDragStart = input.Position
        mainStartPos = MainFrame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then 
                mainDragging = false 
            end
        end)
    end
end)

MainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        mainDragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == mainDragInput and mainDragging then
        local delta = input.Position - mainDragStart
        MainFrame.Position = UDim2.new(mainStartPos.X.Scale, mainStartPos.X.Offset + delta.X, mainStartPos.Y.Scale, mainStartPos.Y.Offset + delta.Y)
    end
end)

-- Toggle menu (ph√¢n bi·ªát drag)
MainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        task.spawn(function()
            task.wait(0.1)
            if mainDragging then return end
            SubFrame.Visible = not SubFrame.Visible
        end)
    end
end)

-- Draggable SubFrame (TitleFrame)
local subDragging, subDragInput, subDragStart, subStartPos
TitleFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        subDragging = true
        subDragStart = input.Position
        subStartPos = SubFrame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then 
                subDragging = false 
            end
        end)
    end
end)

TitleFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        subDragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == subDragInput and subDragging then
        local delta = input.Position - subDragStart
        SubFrame.Position = UDim2.new(subStartPos.X.Scale, subStartPos.X.Offset + delta.X, subStartPos.Y.Scale, subStartPos.Y.Offset + delta.Y)
    end
end)

-- T·∫Øt to√†n b·ªô script
local function destroyScript()
    ScreenGui:Destroy()
    if spinVel then spinVel:Destroy() spinVel = nil end
    pcall(function()
        Humanoid.WalkSpeed = 16
    end)
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character then
            local root = plr.Character:FindFirstChild("HumanoidRootPart")
            local torso = plr.Character:FindFirstChild("Torso") or plr.Character:FindFirstChild("UpperTorso")
            if root then root.Size = Vector3.new(2, 2, 1) root.Transparency = 0 end
            if torso then torso.Size = Vector3.new(2, 2, 1) torso.Transparency = 0 end
        end
    end
    for _, gui in pairs(espGuis) do if gui then gui:Destroy() end end
    espGuis = {}
    isHealing = false
    if toggles.antiKick then
        LocalPlayer.Kick = oldKick
    end
    print("Vietnam Hub ƒë√£ t·∫Øt!")
end

CloseButton.MouseButton1Click:Connect(destroyScript)

-- Function ƒë·ªÉ set hitbox cho m·ªôt player
local function setHitbox(plr, enable)
    if plr ~= LocalPlayer and plr.Character then
        local root = plr.Character:FindFirstChild("HumanoidRootPart")
        local torso = plr.Character:FindFirstChild("Torso") or plr.Character:FindFirstChild("UpperTorso")
        if enable then
            if root then 
                root.Size = Vector3.new(hitboxSize, hitboxSize, hitboxSize) 
                root.Transparency = 0.75 
            end
            if torso then 
                torso.Size = Vector3.new(hitboxSize, hitboxSize, hitboxSize) 
                torso.Transparency = 0.75 
            end
        else
            if root then 
                root.Size = Vector3.new(2, 2, 1) 
                root.Transparency = 0 
            end
            if torso then 
                torso.Size = Vector3.new(2, 2, 1) 
                torso.Transparency = 0 
            end
        end
    end
end

-- Function ƒë·ªÉ set ESP cho m·ªôt player
local function setESP(plr, enable)
    if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("Head") and plr.Character:FindFirstChild("Humanoid") then
        local head = plr.Character.Head
        local hum = plr.Character.Humanoid
        if enable then
            if not espGuis[plr] then
                local bb = Instance.new("BillboardGui")
                bb.Parent = head
                bb.Name = "ESP"
                bb.Size = UDim2.new(0, 110, 0, 55)
                bb.StudsOffset = Vector3.new(0, 3, 0)
                bb.AlwaysOnTop = true
                local label = Instance.new("TextLabel")
                label.Parent = bb
                label.Size = UDim2.new(1, 0, 1, 0)
                label.BackgroundTransparency = 1
                label.TextColor3 = Color3.fromRGB(255, 255, 0)
                label.TextStrokeTransparency = 0
                label.TextStrokeColor3 = Color3.new(0, 0, 0)
                label.TextSize = 15
                label.Font = Enum.Font.GothamBold
                espGuis[plr] = bb
            end
            espGuis[plr].TextLabel.Text = plr.Name .. "\nHP: " .. math.floor(hum.Health) .. "/" .. hum.MaxHealth
        else
            if espGuis[plr] then 
                espGuis[plr]:Destroy() 
                espGuis[plr] = nil
            end
        end
    end
end

-- Toggle ch·ª©c nƒÉng
for key, btn in pairs(tabButtons) do
    btn.MouseButton1Click:Connect(function()
        toggles[key] = not toggles[key]
        local originalName = btn:GetAttribute("OriginalName")
        if toggles[key] then
            btn.BackgroundColor3 = Color3.fromRGB(60, 220, 60)
            btn.Text = originalName .. " (B·∫≠t)"
        else
            btn.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
            btn.Text = originalName .. " (T·∫Øt)"
        end
        
        if key == "spin" then
            if toggles.spin then
                if spinVel then spinVel:Destroy() end
                spinVel = Instance.new("BodyAngularVelocity")
                spinVel.MaxTorque = Vector3.new(0, math.huge, 0)
                spinVel.AngularVelocity = Vector3.new(0, 0, 0)
                spinVel.Parent = RootPart
            else
                if spinVel then spinVel:Destroy() spinVel = nil end
            end
        elseif key == "speed" then
            pcall(function()
                Humanoid.WalkSpeed = toggles.speed and 33 or 16
            end)
        elseif key == "hitbox" then
            for _, plr in ipairs(Players:GetPlayers()) do
                setHitbox(plr, toggles.hitbox)
            end
        elseif key == "esp" then
            for _, plr in ipairs(Players:GetPlayers()) do
                setESP(plr, toggles.esp)
            end
        elseif key == "antiKick" then
            if toggles.antiKick then
                oldKick = LocalPlayer.Kick
                LocalPlayer.Kick = function(self, msg)
                    warn("Anti Kick: ƒê√£ ch·∫∑n kick - L√Ω do: " .. (msg or "Kh√¥ng r√µ"))
                    return
                end
            else
                if oldKick then
                    LocalPlayer.Kick = oldKick
                    oldKick = nil
                end
            end
        end
    end)
end

-- Auto BƒÉng G·∫°c function
local function performHeal()
    if isHealing then return end
    isHealing = true
    local bandage = nil
    for _, obj in ipairs(backpack:GetChildren()) do
        if obj:IsA("Tool") and string.find(string.lower(obj.Name), "bƒÉng") then
            bandage = obj
            break
        end
    end
    if not bandage then 
        isHealing = false 
        return 
    end
    local prevTool = Character:FindFirstChildOfClass("Tool")
    if prevTool then prevTool.Parent = backpack end
    bandage.Parent = Character
    task.wait(0.2)
    bandage:Activate()
    task.wait(1)
    bandage.Parent = backpack
    if prevTool then prevTool.Parent = Character end
    isHealing = false
end

-- Character respawn
local function onCharAdded(char)
    Character = char
    Humanoid = char:WaitForChild("Humanoid")
    RootPart = char:WaitForChild("HumanoidRootPart")
    pcall(function()
        RootPart:SetNetworkOwner(LocalPlayer)
        Humanoid.WalkSpeed = toggles.speed and 33 or 16
    end)
    isHealing = false
    if toggles.spin then
        if spinVel then spinVel:Destroy() end
        spinVel = Instance.new("BodyAngularVelocity")
        spinVel.MaxTorque = Vector3.new(0, math.huge, 0)
        spinVel.AngularVelocity = Vector3.new(0, 0, 0)
        spinVel.Parent = RootPart
    end
end

LocalPlayer.CharacterAdded:Connect(onCharAdded)
if Character then onCharAdded(Character) end

-- Handle new players for hitbox/ESP
Players.PlayerAdded:Connect(function(plr)
    if toggles.hitbox then
        plr.CharacterAdded:Connect(function(char)
            setHitbox(plr, true)
        end)
    end
    if toggles.esp then
        plr.CharacterAdded:Connect(function(char)
            setESP(plr, true)
        end)
    end
end)

-- Handle existing players' character added
for _, plr in ipairs(Players:GetPlayers()) do
    if plr ~= LocalPlayer then
        plr.CharacterAdded:Connect(function(char)
            if toggles.hitbox then setHitbox(plr, true) end
            if toggles.esp then setESP(plr, true) end
        end)
    end
end

-- Heartbeat loop ch√≠nh (ƒë√£ optimize, b·ªè set hitbox/ESP m·ªói frame)
RunService.Heartbeat:Connect(function(dt)
    local tool = Character:FindFirstChildOfClass("Tool")
    
    -- Auto Attack
    if toggles.autoAttack and tool then
        tool:Activate()
    end
    
    -- Spin
    if toggles.spin and spinVel then
        if Humanoid.AutoRotate then
            spinVel.AngularVelocity = Vector3.new(0, 90, 0)
        else
            spinVel.AngularVelocity = Vector3.new(0, 0, 0)
        end
    end
    
    -- Hitbox auto ƒë√°nh g·∫ßn (ch·ªâ t√¨m closest v√† activate, kh√¥ng set size)
    if toggles.hitbox then
        local closest, minDist = nil, 999
        for _, plr in ipairs(Players:GetPlayers()) do
            if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                local dist = (RootPart.Position - plr.Character.HumanoidRootPart.Position).Magnitude
                if dist < minDist then 
                    minDist = dist 
                    closest = plr 
                end
            end
        end
        
        if closest and minDist < 35 and tool then
            tool:Activate()  -- ƒê√°nh li√™n t·ª•c enemy g·∫ßn
        end
    end
    
    -- Update ESP text (ch·ªâ update text, kh√¥ng create m·ªõi)
    if toggles.esp then
        for plr, gui in pairs(espGuis) do
            if plr.Character and plr.Character:FindFirstChild("Humanoid") then
                local hum = plr.Character.Humanoid
                gui.TextLabel.Text = plr.Name .. "\nHP: " .. math.floor(hum.Health) .. "/" .. hum.MaxHealth
            end
        end
    end
    
    -- Auto BƒÉng G·∫°c
    if toggles.autoBandage and Humanoid.Health <= 80 and not isHealing then
        task.spawn(performHeal)
    end
end)

print("Vietnam Hub Updated: Fix lag (set hitbox/ESP ch·ªâ khi c·∫ßn, kh√¥ng m·ªói frame), th√™m Anti ƒêu·ªïi (ch·∫∑n kick). Test nh√© L√¢m! üáªüá≥")
print("H∆∞·ªõng d·∫´n:")
print("1. Click c·ªù VN m·ªü menu")
print("2. K√©o c·ªù VN / ti√™u ƒë·ªÅ menu")
print("3. Speed: 33 khi b·∫≠t")
print("4. Hitbox: ƒê√°nh auto enemy <35 studs (tool spam activate)")
print("5. Auto BƒÉng G·∫°c: HP<=80 t·ª± d√πng + c·∫ßm l·∫°i tool c≈©")
print("6. Anti ƒêu·ªïi: Ch·∫∑n kick kh·ªèi game")
print("7. X t·∫Øt h·∫øt")
