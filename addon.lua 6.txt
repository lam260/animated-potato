-- Vietnam Hub - Dcmoilha Script (ULTRA FAST BANDAGE)
-- Fixed: BƒÉng g·∫°c si√™u t·ªëc, kh√¥i ph·ª•c v·∫≠t ph·∫©m c≈© ngay l·∫≠p t·ª©c

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")
local backpack = LocalPlayer:WaitForChild("Backpack")

-- GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = game.CoreGui
ScreenGui.Name = "VietnamHub"
ScreenGui.ResetOnSpawn = false

-- Main Button
local MainButton = Instance.new("ImageButton")
MainButton.Size = UDim2.new(0, 30, 0, 30)
MainButton.Position = UDim2.new(0.5, -15, 0.5, -15)
MainButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
MainButton.BackgroundTransparency = 0.3
MainButton.Image = ""
MainButton.Parent = ScreenGui
MainButton.Draggable = true

local Crown = Instance.new("TextLabel")
Crown.Size = UDim2.new(1,0,1,0)
Crown.BackgroundTransparency = 1
Crown.Text = "üëë"
Crown.TextSize = 22
Crown.TextColor3 = Color3.fromRGB(255, 215, 0)
Crown.Parent = MainButton

local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(1,0)
Corner.Parent = MainButton

-- Menu
local Menu = Instance.new("Frame")
Menu.Size = UDim2.new(0, 240, 0, 420)
Menu.Position = UDim2.new(0.5, -120, 0.5, -210)
Menu.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
Menu.Visible = false
Menu.Active = true
Menu.Draggable = true
Menu.Parent = ScreenGui

local MenuCorner = Instance.new("UICorner")
MenuCorner.CornerRadius = UDim.new(0,10)
MenuCorner.Parent = Menu

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1,0,0,35)
Title.BackgroundTransparency = 1
Title.Text = "Vietnam Hub - Dcmoilha"
Title.TextColor3 = Color3.fromRGB(255,255,255)
Title.TextSize = 18
Title.Font = Enum.Font.GothamBold
Title.Parent = Menu

-- Scrolling
local Scroll = Instance.new("ScrollingFrame")
Scroll.Size = UDim2.new(1,-10,1,-40)
Scroll.Position = UDim2.new(0,5,0,35)
Scroll.BackgroundTransparency = 1
Scroll.ScrollBarThickness = 5
Scroll.ScrollBarImageColor3 = Color3.fromRGB(200,200,200)
Scroll.Parent = Menu

local List = Instance.new("UIListLayout")
List.Padding = UDim.new(0,6)
List.SortOrder = Enum.SortOrder.LayoutOrder
List.Parent = Scroll

local function UpdateScroll()
    Scroll.CanvasSize = UDim2.new(0,0,0,List.AbsoluteContentSize.Y + 10)
end
List:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(UpdateScroll)

-- Toggle + Input Helpers
local function NewToggle(name, callback)
    local f = Instance.new("Frame")
    f.Size = UDim2.new(1,0,0,40)
    f.BackgroundTransparency = 1
    f.Parent = Scroll

    local lbl = Instance.new("TextLabel")
    lbl.Size = UDim2.new(0.6,0,1,0)
    lbl.BackgroundTransparency = 1
    lbl.Text = name
    lbl.TextColor3 = Color3.fromRGB(220,220,220)
    lbl.TextSize = 15
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.Parent = f

    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0.35,0,0.75,0)
    btn.Position = UDim2.new(0.62,0,0.125,0)
    btn.BackgroundColor3 = Color3.fromRGB(60,60,60)
    btn.Text = "OFF"
    btn.TextColor3 = Color3.fromRGB(255,80,80)
    btn.TextSize = 14
    btn.Font = Enum.Font.Gotham
    btn.Parent = f

    local bc = Instance.new("UICorner")
    bc.CornerRadius = UDim.new(0,6)
    bc.Parent = btn

    local enabled = false

    btn.MouseButton1Click:Connect(function()
        enabled = not enabled
        btn.Text = enabled and "ON" or "OFF"
        btn.TextColor3 = enabled and Color3.fromRGB(80,255,80) or Color3.fromRGB(255,80,80)
        btn.BackgroundColor3 = enabled and Color3.fromRGB(30,100,30) or Color3.fromRGB(80,30,30)
        callback(enabled)
    end)

    return function() return enabled end, function(v) 
        enabled = v
        btn.Text = v and "ON" or "OFF"
        btn.TextColor3 = v and Color3.fromRGB(80,255,80) or Color3.fromRGB(255,80,80)
        btn.BackgroundColor3 = v and Color3.fromRGB(30,100,30) or Color3.fromRGB(80,30,30)
        callback(v)
    end
end

local function NewInput(name, def)
    local f = Instance.new("Frame")
    f.Size = UDim2.new(1,0,0,45)
    f.BackgroundTransparency = 1
    f.Parent = Scroll

    local lbl = Instance.new("TextLabel")
    lbl.Size = UDim2.new(1,0,0.4,0)
    lbl.BackgroundTransparency = 1
    lbl.Text = name
    lbl.TextColor3 = Color3.fromRGB(180,180,180)
    lbl.TextSize = 13
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.Parent = f

    local box = Instance.new("TextBox")
    box.Size = UDim2.new(1,0,0.5,0)
    box.Position = UDim2.new(0,0,0.5,0)
    box.BackgroundColor3 = Color3.fromRGB(45,45,45)
    box.Text = tostring(def)
    box.TextColor3 = Color3.fromRGB(255,255,255)
    box.TextSize = 14
    box.Parent = f

    local ic = Instance.new("UICorner")
    ic.CornerRadius = UDim.new(0,5)
    ic.Parent = box

    local val = def
    box.FocusLost:Connect(function()
        val = tonumber(box.Text) or def
        box.Text = tostring(val)
    end)

    return function() return val end
end

-- Vars
local conns = {}
local hitboxes = {}
local esps = {}
local isHealing = false
local spinVel = nil
local lastTool = nil -- L∆∞u tool c≈© ƒë·ªÉ kh√¥i ph·ª•c

local function DisconnectAll()
    for _, c in pairs(conns) do if c then c:Disconnect() end end
    conns = {}
end

local function ClearHitboxes()
    for _, h in pairs(hitboxes) do if h then h:Destroy() end end
    hitboxes = {}
end

local function ClearESPs()
    for _, e in pairs(esps) do if e then e:Destroy() end end
    esps = {}
end

-- ULTRA FAST: T·ª± ƒë·ªông h·ªìi m√°u si√™u t·ªëc
local function performQuickHeal()
    if isHealing then return end
    isHealing = true
    
    -- Ki·ªÉm tra character t·ªìn t·∫°i
    if not Character or not Character.Parent then
        isHealing = false
        return
    end
    
    -- L∆∞u tool ƒëang c·∫ßm hi·ªán t·∫°i
    local currentTool = Character:FindFirstChildOfClass("Tool")
    if currentTool then
        lastTool = currentTool
    end
    
    -- T√¨m bƒÉng g·∫°c si√™u nhanh
    local bandage = nil
    for _, item in ipairs(backpack:GetChildren()) do
        if item:IsA("Tool") then
            local nameLower = string.lower(item.Name)
            if string.find(nameLower, "bandage") or 
               string.find(nameLower, "bƒÉng") or 
               string.find(nameLower, "g·∫°c") or
               string.find(nameLower, "med") or
               string.find(nameLower, "health") or
               string.find(nameLower, "heal") then
                bandage = item
                break
            end
        end
    end
    
    if not bandage then
        -- T√¨m trong character (c√≥ th·ªÉ ƒëang c·∫ßm)
        for _, item in ipairs(Character:GetChildren()) do
            if item:IsA("Tool") then
                local nameLower = string.lower(item.Name)
                if string.find(nameLower, "bandage") or 
                   string.find(nameLower, "bƒÉng") or 
                   string.find(nameLower, "g·∫°c") or
                   string.find(nameLower, "med") or
                   string.find(nameLower, "health") or
                   string.find(nameLower, "heal") then
                    bandage = item
                    break
                end
            end
        end
    end
    
    if not bandage then
        isHealing = false
        return
    end
    
    -- TH1: BƒÉng g·∫°c trong backpack
    if bandage.Parent == backpack then
        -- Unequip tool hi·ªán t·∫°i n·∫øu c√≥
        if currentTool then
            currentTool.Parent = backpack
        end
        
        -- Equip bƒÉng g·∫°c si√™u nhanh
        bandage.Parent = Character
        
        -- K√≠ch ho·∫°t bƒÉng g·∫°c ngay l·∫≠p t·ª©c
        if Character:FindFirstChild(bandage.Name) then
            -- K√≠ch ho·∫°t nhi·ªÅu l·∫ßn ƒë·ªÉ ch·∫Øc ch·∫Øn
            for i = 1, 5 do
                bandage:Activate()
                RunService.RenderStepped:Wait()
            end
        end
        
        -- Tr·∫£ bƒÉng g·∫°c v·ªÅ backpack ngay
        bandage.Parent = backpack
        
        -- Kh√¥i ph·ª•c tool c≈© NGAY L·∫¨P T·ª®C
        if lastTool then
            lastTool.Parent = Character
        end
    
    -- TH2: BƒÉng g·∫°c ƒëang ƒë∆∞·ª£c c·∫ßm
    elseif bandage.Parent == Character then
        -- K√≠ch ho·∫°t tr·ª±c ti·∫øp
        for i = 1, 5 do
            bandage:Activate()
            RunService.RenderStepped:Wait()
        end
    end
    
    isHealing = false
end

-- Features
local spinSpeed = NewInput("T·ªëc ƒë·ªô xoay:", 10)
local hitSize = NewInput("K√≠ch c·ª° Hitbox:", 5)
local healThreshold = NewInput("H·ªìi m√°u khi d∆∞·ªõi:", 80)

local autoAtkGet, autoAtkSet = NewToggle("Tab1: Auto ƒê√°nh", function(on)
    -- X√≥a k·∫øt n·ªëi auto ƒë√°nh c≈©
    for i = #conns, 1, -1 do
        if tostring(conns[i]):find("Auto ƒê√°nh") then
            conns[i]:Disconnect()
            table.remove(conns, i)
        end
    end
    
    if on then
        print("[DEBUG] Auto ƒê√°nh B·∫¨T")
        local conn = RunService.Heartbeat:Connect(function()
            local tool = Character:FindFirstChildOfClass("Tool")
            if tool and tool:IsA("Tool") then
                tool:Activate()
            end
        end)
        conns["Auto ƒê√°nh"] = conn
    else
        print("[DEBUG] Auto ƒê√°nh T·∫ÆT")
    end
end)

local spinGet, spinSet = NewToggle("Tab2: Xoay", function(on)
    if on then
        print("[DEBUG] Xoay B·∫¨T")
        if spinVel then spinVel:Destroy() end
        
        spinVel = Instance.new("BodyAngularVelocity")
        spinVel.Name = "SpinVelocity"
        spinVel.MaxTorque = Vector3.new(0, math.huge, 0)
        spinVel.AngularVelocity = Vector3.new(0, spinSpeed(), 0)
        spinVel.P = 10000
        spinVel.Parent = HumanoidRootPart
    else
        print("[DEBUG] Xoay T·∫ÆT")
        if spinVel then 
            spinVel:Destroy()
            spinVel = nil
        end
    end
end)

local speedGet, speedSet = NewToggle("Tab3: Speed", function(on)
    if Humanoid then
        Humanoid.WalkSpeed = on and 32 or 16
        print("[DEBUG] Speed "..(on and "B·∫¨T" or "T·∫ÆT"))
    end
end)

local hitGet, hitSet = NewToggle("Tab4: Hitbox", function(on)
    ClearHitboxes()
    
    -- X√≥a k·∫øt n·ªëi hitbox c≈©
    if conns["Hitbox"] then
        conns["Hitbox"]:Disconnect()
        conns["Hitbox"] = nil
    end
    
    if on then
        print("[DEBUG] Hitbox B·∫¨T")
        local conn = RunService.Heartbeat:Connect(function()
            for _, p in Players:GetPlayers() do
                if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                    local r = p.Character.HumanoidRootPart
                    local hb = hitboxes[p.UserId] or Instance.new("Part")
                    hb.Size = Vector3.new(hitSize(), hitSize(), hitSize())
                    hb.Transparency = 0.6
                    hb.BrickColor = BrickColor.new("Bright red")
                    hb.Material = Enum.Material.Neon
                    hb.Anchored = true
                    hb.CanCollide = false
                    hb.Parent = p.Character
                    hb.CFrame = r.CFrame
                    hitboxes[p.UserId] = hb

                    local op = OverlapParams.new()
                    op.FilterDescendantsInstances = {Character}
                    op.FilterType = Enum.RaycastFilterType.Include
                    
                    if workspace:GetPartsInPart(hb, op) and #workspace:GetPartsInPart(hb, op) > 0 then
                        local tool = Character:FindFirstChildOfClass("Tool")
                        if tool then
                            local mr = HumanoidRootPart
                            local tp = Vector3.new(r.Position.X, mr.Position.Y, r.Position.Z)
                            mr.CFrame = CFrame.new(mr.Position, tp)
                            tool:Activate()
                        end
                    end
                end
            end
        end)
        conns["Hitbox"] = conn
    else
        print("[DEBUG] Hitbox T·∫ÆT")
        ClearHitboxes()
    end
end)

-- ULTRA FAST: BƒÉng G·∫°c si√™u t·ªëc
local bandGet, bandSet = NewToggle("Tab5: BƒÉng G·∫°c", function(on)
    -- X√≥a k·∫øt n·ªëi bƒÉng g·∫°c c≈©
    if conns["BƒÉng G·∫°c"] then
        conns["BƒÉng G·∫°c"]:Disconnect()
        conns["BƒÉng G·∫°c"] = nil
    end
    
    if on then
        print("[DEBUG] BƒÉng G·∫°c B·∫¨T (Ng∆∞·ª°ng: " .. healThreshold() .. " HP)")
        
        -- Bi·∫øn ƒë·ªÉ tr√°nh spam
        local lastHealTime = 0
        local healCooldown = 1.5 -- Cooldown 1.5 gi√¢y
        
        local conn = RunService.Heartbeat:Connect(function()
            -- Ki·ªÉm tra character t·ªìn t·∫°i
            if not Character or not Character.Parent then
                return
            end
            
            -- Ki·ªÉm tra humanoid
            local currentHumanoid = Character:FindFirstChild("Humanoid")
            if not currentHumanoid or currentHumanoid.Health <= 0 then 
                return 
            end
            
            local currentHealth = currentHumanoid.Health
            local threshold = healThreshold()
            local currentTime = tick()
            
            -- Ki·ªÉm tra n·∫øu m√°u d∆∞·ªõi ng∆∞·ª°ng V√Ä ƒë√£ qua cooldown
            if currentHealth < threshold and not isHealing and (currentTime - lastHealTime) > healCooldown then
                -- Th·ª±c hi·ªán h·ªìi m√°u
                performQuickHeal()
                
                -- C·∫≠p nh·∫≠t th·ªùi gian h·ªìi m√°u cu·ªëi c√πng
                lastHealTime = currentTime
            end
        end)
        
        conns["BƒÉng G·∫°c"] = conn
    else
        print("[DEBUG] BƒÉng G·∫°c T·∫ÆT")
        isHealing = false
    end
end)

local espGet, espSet = NewToggle("Tab6: ESP (M√°u)", function(on)
    ClearESPs()
    
    -- X√≥a k·∫øt n·ªëi ESP c≈©
    if conns["ESP"] then
        conns["ESP"]:Disconnect()
        conns["ESP"] = nil
    end
    
    if on then
        print("[DEBUG] ESP B·∫¨T")
        
        -- H√†m t·∫°o ESP cho m·ªôt ng∆∞·ªùi ch∆°i
        local function createESP(player)
            if player == LocalPlayer then return end
            if not player.Character then return end
            
            local head = player.Character:FindFirstChild("Head")
            local humanoid = player.Character:FindFirstChild("Humanoid")
            
            if not head or not humanoid then return end
            
            -- X√≥a ESP c≈© n·∫øu c√≥
            if esps[player] and esps[player][1] then
                esps[player][1]:Destroy()
            end
            
            local bb = Instance.new("BillboardGui")
            bb.Name = "ESP_" .. player.Name
            bb.Parent = head
            bb.Size = UDim2.new(0, 80, 0, 30)
            bb.StudsOffset = Vector3.new(0, 3, 0)
            bb.AlwaysOnTop = true
            bb.Adornee = head

            local t = Instance.new("TextLabel")
            t.Name = "HealthText"
            t.Size = UDim2.new(1, 0, 1, 0)
            t.BackgroundTransparency = 1
            t.Text = math.floor(humanoid.Health)
            t.TextColor3 = Color3.new(1, 1, 1)
            t.TextStrokeTransparency = 0
            t.TextStrokeColor3 = Color3.new(0, 0, 0)
            t.TextSize = 14
            t.Font = Enum.Font.GothamBold
            t.Parent = bb

            esps[player] = {bb, t, humanoid}
        end
        
        -- T·∫°o ESP cho t·∫•t c·∫£ ng∆∞·ªùi ch∆°i hi·ªán c√≥
        for _, player in Players:GetPlayers() do
            createESP(player)
        end
        
        -- Th√™m ESP khi c√≥ ng∆∞·ªùi ch∆°i m·ªõi
        local playerAddedConn = Players.PlayerAdded:Connect(function(player)
            player.CharacterAdded:Connect(function()
                createESP(player)
            end)
        end)
        
        -- C·∫≠p nh·∫≠t ESP theo th·ªùi gian th·ª±c
        local conn = RunService.Heartbeat:Connect(function()
            for player, data in pairs(esps) do
                if player and player.Character and player.Character:FindFirstChild("Humanoid") and data[1] and data[2] then
                    local health = math.floor(player.Character.Humanoid.Health)
                    data[2].Text = tostring(health)
                    
                    -- ƒê·ªïi m√†u theo m√°u
                    if health > 50 then
                        data[2].TextColor3 = Color3.fromRGB(0, 255, 0)
                    elseif health > 25 then
                        data[2].TextColor3 = Color3.fromRGB(255, 255, 0)
                    else
                        data[2].TextColor3 = Color3.fromRGB(255, 0, 0)
                    end
                else
                    -- X√≥a ESP n·∫øu ng∆∞·ªùi ch∆°i kh√¥ng c√≤n t·ªìn t·∫°i
                    if data and data[1] then
                        data[1]:Destroy()
                    end
                    esps[player] = nil
                end
            end
        end)
        
        conns["ESP"] = conn
        conns["PlayerAdded"] = playerAddedConn
    else
        print("[DEBUG] ESP T·∫ÆT")
        ClearESPs()
    end
end)

UpdateScroll()

-- Open/Close Menu
MainButton.MouseButton1Click:Connect(function()
    Menu.Visible = not Menu.Visible
end)

-- Character respawn handler
local function onCharAdded(char)
    print("[DEBUG] ƒê√£ spawn character m·ªõi")
    Character = char
    Humanoid = char:WaitForChild("Humanoid")
    HumanoidRootPart = char:WaitForChild("HumanoidRootPart")
    
    -- Reset bi·∫øn
    isHealing = false
    lastTool = nil
    
    -- Kh√¥i ph·ª•c t·ªëc ƒë·ªô di chuy·ªÉn
    if speedGet() then
        Humanoid.WalkSpeed = 32
    end
    
    -- Kh√¥i ph·ª•c xoay
    if spinGet() then
        if spinVel then spinVel:Destroy() end
        spinVel = Instance.new("BodyAngularVelocity")
        spinVel.Name = "SpinVelocity"
        spinVel.MaxTorque = Vector3.new(0, math.huge, 0)
        spinVel.AngularVelocity = Vector3.new(0, spinSpeed(), 0)
        spinVel.P = 10000
        spinVel.Parent = HumanoidRootPart
    end
    
    -- Clear c√°c ƒë·ªëi t∆∞·ª£ng c≈©
    ClearHitboxes()
    ClearESPs()
    
    -- T·ª± ƒë·ªông b·∫≠t l·∫°i c√°c t√≠nh nƒÉng ƒëang ON
    task.wait(0.5)
    
    if autoAtkGet() then
        autoAtkSet(true)
    end
    
    if hitGet() then
        hitSet(true)
    end
    
    if bandGet() then
        bandSet(true)
    end
    
    if espGet() then
        espSet(true)
    end
    
    print("[Vietnam Hub] ƒê√£ kh√¥i ph·ª•c t·∫•t c·∫£ t√≠nh nƒÉng!")
end

-- K·∫øt n·ªëi s·ª± ki·ªán
LocalPlayer.CharacterAdded:Connect(onCharAdded)

-- Kh·ªüi t·∫°o ban ƒë·∫ßu
if Character then
    task.wait(1)
    onCharAdded(Character)
end

-- C·∫≠p nh·∫≠t t·ªëc ƒë·ªô xoay khi thay ƒë·ªïi gi√° tr·ªã
spawn(function()
    local lastSpinSpeed = spinSpeed()
    while true do
        task.wait(0.3)
        local currentSpinSpeed = spinSpeed()
        if currentSpinSpeed ~= lastSpinSpeed and spinGet() then
            lastSpinSpeed = currentSpinSpeed
            if spinVel then
                spinVel.AngularVelocity = Vector3.new(0, currentSpinSpeed, 0)
            end
        end
    end
end)

print("[Vietnam Hub] ƒê√£ load xong! B·∫≠t menu ƒë·ªÉ s·ª≠ d·ª•ng.")
