-- Vietnam Hub - Dcmoilha Script (ULTRA FAST BANDAGE + Hitbox Fix)
-- Fixed: BƒÉng g·∫°c si√™u t·ªëc, kh√¥i ph·ª•c khi respawn, Hitbox ch·ªâ ƒë√°nh khi b·∫°n v√†o v√πng

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")
local backpack = LocalPlayer:WaitForChild("Backpack")

-- GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = game.CoreGui
ScreenGui.Name = "VietnamHub"
ScreenGui.ResetOnSpawn = false

local MainButton = Instance.new("ImageButton")
MainButton.Size = UDim2.new(0, 30, 0, 30)
MainButton.Position = UDim2.new(0.5, -15, 0.5, -15)
MainButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
MainButton.BackgroundTransparency = 0.3
MainButton.Image = ""
MainButton.Parent = ScreenGui
MainButton.Draggable = true

local Crown = Instance.new("TextLabel")
Crown.Size = UDim2.new(1,0,1,0)
Crown.BackgroundTransparency = 1
Crown.Text = "üëë"
Crown.TextSize = 22
Crown.TextColor3 = Color3.fromRGB(255, 215, 0)
Crown.Parent = MainButton

local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(1,0)
Corner.Parent = MainButton

local Menu = Instance.new("Frame")
Menu.Size = UDim2.new(0, 240, 0, 420)
Menu.Position = UDim2.new(0.5, -120, 0.5, -210)
Menu.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
Menu.Visible = false
Menu.Active = true
Menu.Draggable = true
Menu.Parent = ScreenGui

local MenuCorner = Instance.new("UICorner")
MenuCorner.CornerRadius = UDim.new(0,10)
MenuCorner.Parent = Menu

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1,0,0,35)
Title.BackgroundTransparency = 1
Title.Text = "Vietnam Hub - Dcmoilha"
Title.TextColor3 = Color3.fromRGB(255,255,255)
Title.TextSize = 18
Title.Font = Enum.Font.GothamBold
Title.Parent = Menu

local Scroll = Instance.new("ScrollingFrame")
Scroll.Size = UDim2.new(1,-10,1,-40)
Scroll.Position = UDim2.new(0,5,0,35)
Scroll.BackgroundTransparency = 1
Scroll.ScrollBarThickness = 5
Scroll.ScrollBarImageColor3 = Color3.fromRGB(200,200,200)
Scroll.Parent = Menu

local List = Instance.new("UIListLayout")
List.Padding = UDim.new(0,6)
List.SortOrder = Enum.SortOrder.LayoutOrder
List.Parent = Scroll

local function UpdateScroll()
    Scroll.CanvasSize = UDim2.new(0,0,0,List.AbsoluteContentSize.Y + 10)
end
List:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(UpdateScroll)

-- Toggle + Input Helpers
local function NewToggle(name, callback)
    local f = Instance.new("Frame")
    f.Size = UDim2.new(1,0,0,40)
    f.BackgroundTransparency = 1
    f.Parent = Scroll

    local lbl = Instance.new("TextLabel")
    lbl.Size = UDim2.new(0.6,0,1,0)
    lbl.BackgroundTransparency = 1
    lbl.Text = name
    lbl.TextColor3 = Color3.fromRGB(220,220,220)
    lbl.TextSize = 15
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.Parent = f

    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0.35,0,0.75,0)
    btn.Position = UDim2.new(0.62,0,0.125,0)
    btn.BackgroundColor3 = Color3.fromRGB(60,60,60)
    btn.Text = "OFF"
    btn.TextColor3 = Color3.fromRGB(255,80,80)
    btn.TextSize = 14
    btn.Font = Enum.Font.Gotham
    btn.Parent = f

    local bc = Instance.new("UICorner")
    bc.CornerRadius = UDim.new(0,6)
    bc.Parent = btn

    local enabled = false

    local function updateUI()
        btn.Text = enabled and "ON" or "OFF"
        btn.TextColor3 = enabled and Color3.fromRGB(80,255,80) or Color3.fromRGB(255,80,80)
        btn.BackgroundColor3 = enabled and Color3.fromRGB(30,100,30) or Color3.fromRGB(80,30,30)
    end

    btn.MouseButton1Click:Connect(function()
        enabled = not enabled
        updateUI()
        callback(enabled)
    end)

    updateUI()

    return function() return enabled end, function(v)
        enabled = v
        updateUI()
        callback(v)
    end
end

local function NewInput(name, def)
    local f = Instance.new("Frame")
    f.Size = UDim2.new(1,0,0,45)
    f.BackgroundTransparency = 1
    f.Parent = Scroll

    local lbl = Instance.new("TextLabel")
    lbl.Size = UDim2.new(1,0,0.4,0)
    lbl.BackgroundTransparency = 1
    lbl.Text = name
    lbl.TextColor3 = Color3.fromRGB(180,180,180)
    lbl.TextSize = 13
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.Parent = f

    local box = Instance.new("TextBox")
    box.Size = UDim2.new(1,0,0.5,0)
    box.Position = UDim2.new(0,0,0.5,0)
    box.BackgroundColor3 = Color3.fromRGB(45,45,45)
    box.Text = tostring(def)
    box.TextColor3 = Color3.fromRGB(255,255,255)
    box.TextSize = 14
    box.Parent = f

    local ic = Instance.new("UICorner")
    ic.CornerRadius = UDim.new(0,5)
    ic.Parent = box

    local val = def
    box.FocusLost:Connect(function()
        val = tonumber(box.Text) or def
        box.Text = tostring(val)
    end)

    return function() return val end
end

-- Bi·∫øn qu·∫£n l√Ω
local conns = {}
local hitboxes = {}
local esps = {}
local isHealing = false
local spinVel = nil
local lastTool = nil

local features = {
    AutoAttack = {enabled = false, conn = nil},
    Spin        = {enabled = false, obj = nil},
    Speed       = {enabled = false},
    Hitbox      = {enabled = false, conn = nil},
    Bandage     = {enabled = false, conn = nil},
    ESP         = {enabled = false, conn = nil, playerAddedConn = nil},
}

local function ClearHitboxes()
    for _, h in pairs(hitboxes) do if h then h:Destroy() end end
    hitboxes = {}
end

local function ClearESPs()
    for _, e in pairs(esps) do if e then e:Destroy() end end
    esps = {}
end

-- ULTRA FAST BANDAGE
local function performQuickHeal()
    if isHealing then return end
    isHealing = true
    
    if not Character or not Character.Parent then
        isHealing = false
        return
    end
    
    local currentTool = Character:FindFirstChildOfClass("Tool")
    if currentTool then lastTool = currentTool end
    
    local bandage = nil
    for _, item in ipairs(backpack:GetChildren()) do
        if item:IsA("Tool") then
            local n = string.lower(item.Name)
            if n:find("bandage") or n:find("bƒÉng") or n:find("g·∫°c") or n:find("med") or n:find("health") or n:find("heal") then
                bandage = item
                break
            end
        end
    end
    
    if not bandage then
        for _, item in ipairs(Character:GetChildren()) do
            if item:IsA("Tool") then
                local n = string.lower(item.Name)
                if n:find("bandage") or n:find("bƒÉng") or n:find("g·∫°c") or n:find("med") or n:find("health") or n:find("heal") then
                    bandage = item
                    break
                end
            end
        end
    end
    
    if not bandage then
        isHealing = false
        return
    end
    
    if bandage.Parent == backpack then
        if currentTool then currentTool.Parent = backpack end
        bandage.Parent = Character
        task.wait()
        if Character:FindFirstChild(bandage.Name) then
            for _ = 1, 5 do
                bandage:Activate()
                RunService.RenderStepped:Wait()
            end
        end
        bandage.Parent = backpack
        if lastTool and lastTool.Parent == backpack then
            lastTool.Parent = Character
        end
    elseif bandage.Parent == Character then
        for _ = 1, 5 do
            bandage:Activate()
            RunService.RenderStepped:Wait()
        end
    end
    
    isHealing = false
end

-- Inputs
local spinSpeed = NewInput("T·ªëc ƒë·ªô xoay:", 10)
local hitSize   = NewInput("K√≠ch c·ª° Hitbox:", 5)
local healThreshold = NewInput("H·ªìi m√°u khi d∆∞·ªõi:", 80)

-- Tab1: Auto ƒê√°nh
local autoAtkGet, autoAtkSet = NewToggle("Tab1: Auto ƒê√°nh", function(on)
    features.AutoAttack.enabled = on
    if on then
        if features.AutoAttack.conn then features.AutoAttack.conn:Disconnect() end
        features.AutoAttack.conn = RunService.Heartbeat:Connect(function()
            local tool = Character and Character:FindFirstChildOfClass("Tool")
            if tool then tool:Activate() end
        end)
    else
        if features.AutoAttack.conn then
            features.AutoAttack.conn:Disconnect()
            features.AutoAttack.conn = nil
        end
    end
end)

-- Tab2: Xoay
local spinGet, spinSet = NewToggle("Tab2: Xoay", function(on)
    features.Spin.enabled = on
    if on then
        if spinVel then spinVel:Destroy() end
        spinVel = Instance.new("BodyAngularVelocity")
        spinVel.Name = "SpinVelocity"
        spinVel.MaxTorque = Vector3.new(0, math.huge, 0)
        spinVel.AngularVelocity = Vector3.new(0, spinSpeed(), 0)
        spinVel.P = 10000
        spinVel.Parent = HumanoidRootPart
        features.Spin.obj = spinVel
    else
        if spinVel then spinVel:Destroy() spinVel = nil end
        features.Spin.obj = nil
    end
end)

-- Tab3: Speed
local speedGet, speedSet = NewToggle("Tab3: Speed", function(on)
    features.Speed.enabled = on
    if Humanoid then
        Humanoid.WalkSpeed = on and 32 or 16
    end
end)

-- Tab4: Hitbox (ch·ªâ auto ƒë√°nh khi b·∫°n n·∫±m TRONG hitbox c·ªßa ƒë·ªëi th·ªß)
local hitGet, hitSet = NewToggle("Tab4: Hitbox Expand + Auto Hit", function(on)
    features.Hitbox.enabled = on
    ClearHitboxes()
    
    if features.Hitbox.conn then
        features.Hitbox.conn:Disconnect()
        features.Hitbox.conn = nil
    end
    
    if on then
        features.Hitbox.conn = RunService.Heartbeat:Connect(function()
            if not Character or not HumanoidRootPart then return end
            
            local localPos = HumanoidRootPart.Position
            
            for _, p in Players:GetPlayers() do
                if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                    local targetRoot = p.Character.HumanoidRootPart
                    
                    -- T·∫°o / c·∫≠p nh·∫≠t hitbox
                    local hb = hitboxes[p.UserId] or Instance.new("Part")
                    hb.Name = "Hitbox_" .. p.Name
                    hb.Size = Vector3.new(hitSize(), hitSize(), hitSize())
                    hb.Transparency = 0.7
                    hb.BrickColor = BrickColor.new("Bright red")
                    hb.Material = Enum.Material.Neon
                    hb.Anchored = true
                    hb.CanCollide = false
                    hb.Parent = workspace
                    hb.CFrame = targetRoot.CFrame
                    hitboxes[p.UserId] = hb
                    
                    -- Ki·ªÉm tra b·∫°n c√≥ n·∫±m trong v√πng hitbox kh√¥ng
                    local distance = (localPos - targetRoot.Position).Magnitude
                    local hitboxRadius = hitSize() / 2
                    
                    if distance <= hitboxRadius then
                        local tool = Character:FindFirstChildOfClass("Tool")
                        if tool then
                            -- Quay m·∫∑t v·ªÅ ƒë·ªëi th·ªß (gi·ªØ nguy√™n chi·ªÅu cao)
                            local lookAt = Vector3.new(targetRoot.Position.X, localPos.Y, targetRoot.Position.Z)
                            HumanoidRootPart.CFrame = CFrame.new(localPos, lookAt)
                            
                            -- Auto ƒë√°nh
                            tool:Activate()
                        end
                    end
                end
            end
        end)
    else
        ClearHitboxes()
    end
end)

-- Tab5: BƒÉng G·∫°c
local bandGet, bandSet = NewToggle("Tab5: BƒÉng G·∫°c", function(on)
    features.Bandage.enabled = on
    if features.Bandage.conn then
        features.Bandage.conn:Disconnect()
        features.Bandage.conn = nil
    end
    
    if on then
        local lastHealTime = 0
        local cooldown = 1.5
        
        features.Bandage.conn = RunService.Heartbeat:Connect(function()
            if not Character or not Humanoid or Humanoid.Health <= 0 then return end
            
            local now = tick()
            if Humanoid.Health < healThreshold() and not isHealing and (now - lastHealTime) > cooldown then
                performQuickHeal()
                lastHealTime = now
            end
        end)
    end
end)

-- Tab6: ESP
local espGet, espSet = NewToggle("Tab6: ESP (M√°u)", function(on)
    features.ESP.enabled = on
    ClearESPs()
    if features.ESP.conn then features.ESP.conn:Disconnect() features.ESP.conn = nil end
    if features.ESP.playerAddedConn then features.ESP.playerAddedConn:Disconnect() features.ESP.playerAddedConn = nil end
    
    if on then
        local function createESP(p)
            if p == LocalPlayer or not p.Character then return end
            local head = p.Character:FindFirstChild("Head")
            local hum = p.Character:FindFirstChild("Humanoid")
            if not head or not hum then return end
            
            local bb = Instance.new("BillboardGui")
            bb.Name = "ESP_"..p.Name
            bb.Parent = head
            bb.Size = UDim2.new(0,80,0,30)
            bb.StudsOffset = Vector3.new(0,3,0)
            bb.AlwaysOnTop = true
            bb.Adornee = head

            local txt = Instance.new("TextLabel")
            txt.Size = UDim2.new(1,0,1,0)
            txt.BackgroundTransparency = 1
            txt.Text = math.floor(hum.Health)
            txt.TextColor3 = Color3.new(1,1,1)
            txt.TextStrokeTransparency = 0
            txt.TextStrokeColor3 = Color3.new(0,0,0)
            txt.TextSize = 14
            txt.Font = Enum.Font.GothamBold
            txt.Parent = bb

            esps[p] = {bb, txt, hum}
        end
        
        for _, p in Players:GetPlayers() do createESP(p) end
        
        features.ESP.playerAddedConn = Players.PlayerAdded:Connect(function(p)
            p.CharacterAdded:Connect(function() createESP(p) end)
        end)
        
        features.ESP.conn = RunService.Heartbeat:Connect(function()
            for p, data in pairs(esps) do
                if p and p.Character and p.Character:FindFirstChild("Humanoid") and data[1] and data[2] then
                    local h = math.floor(p.Character.Humanoid.Health)
                    data[2].Text = tostring(h)
                    data[2].TextColor3 = h > 50 and Color3.fromRGB(0,255,0) or (h > 25 and Color3.fromRGB(255,255,0) or Color3.fromRGB(255,0,0))
                else
                    if data[1] then data[1]:Destroy() end
                    esps[p] = nil
                end
            end
        end)
    end
end)

UpdateScroll()

MainButton.MouseButton1Click:Connect(function()
    Menu.Visible = not Menu.Visible
end)

-- Respawn handler
local function onCharAdded(char)
    Character = char
    Humanoid = char:WaitForChild("Humanoid")
    HumanoidRootPart = char:WaitForChild("HumanoidRootPart")
    
    isHealing = false
    lastTool = nil
    ClearHitboxes()
    ClearESPs()
    
    task.wait(0.4)
    
    if features.AutoAttack.enabled then autoAtkSet(true) end
    if features.Spin.enabled        then spinSet(true)    end
    if features.Speed.enabled       then speedSet(true)   end
    if features.Hitbox.enabled      then hitSet(true)     end
    if features.Bandage.enabled     then bandSet(true)    end
    if features.ESP.enabled         then espSet(true)      end
    
    print("[Vietnam Hub] Respawn - ƒê√£ kh√¥i ph·ª•c t√≠nh nƒÉng ƒëang b·∫≠t")
end

LocalPlayer.CharacterAdded:Connect(onCharAdded)

if Character then
    task.wait(1)
    onCharAdded(Character)
end

-- C·∫≠p nh·∫≠t t·ªëc ƒë·ªô xoay realtime
spawn(function()
    local last = spinSpeed()
    while true do
        task.wait(0.3)
        local cur = spinSpeed()
        if cur ~= last and features.Spin.enabled and spinVel then
            last = cur
            spinVel.AngularVelocity = Vector3.new(0, cur, 0)
        end
    end
end)

print("[Vietnam Hub] ƒê√£ load xong! Nh·∫•n n√∫t üëë ƒë·ªÉ m·ªü menu.")
